<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ArcGIS Javascript API Test</title>
  <style>html,body,#viewDiv { padding: 0; margin: 0; height: 100%; width: 100%; overflow: hidden; }</style>
  <link rel="stylesheet" href="https://app.gdeei.cn/arcgis-js-api/library/4.18/esri/themes/light/main.css" />
  <script>
  function beforeRequestCallback(param) {
    const headers = param.requestOptions.headers || {};
    headers['X-Requested-With'] = 'XMLHttpRequest';
    const jwt = localStorage.getItem('Bearer:/gishub/api');
    if (!!jwt) {
        headers['Authorization'] = `Bearer ${jwt}`;
    }
    param.requestOptions.headers = headers;
  }

  function getQuery(name) {
    const arr = location.search.substring(1).split('&');
    const q = {};
    for (const item of arr) {
      const itemArr = item.split('=');
      q[itemArr[0]] = itemArr[1];
    }
    return q[name];
  }

  window.dojoConfig = { locale: 'zh-cn', async: true };
  window.esriConfig = {
    locale: 'zh-cn',
    request: {
      interceptors: [
        { urls: /gishub/, before: beforeRequestCallback }
      ]
    }
  };
  </script>
  <script src="https://app.gdeei.cn/arcgis-js-api/library/4.18/init.js"></script>
</head>

<body>
  <div id="viewDiv"></div>
<script>
let demo = getQuery('demo');
if (!demo.endsWith('.js')) {
    demo += '.js'
}
require([`./${demo}`]);
</script>
</body>

</html>
