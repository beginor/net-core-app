<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ArcGIS Javascript API Test</title>
  <style>html,body,#viewDiv { padding: 0; margin: 0; height: 100%; width: 100%; overflow: hidden; }</style>
  <link rel="stylesheet" href="https://app.gdeei.cn/arcgis-js-api/library/4.17/esri/themes/light/main.css" />
  <script>
  window.dojoConfig = { locale: 'zh-cn', async: true };
  window.esriConfig = { locale: 'zh-cn' };
  </script>
  <script src="https://app.gdeei.cn/arcgis-js-api/library/4.17/init.js"></script>
</head>

<body>
  <div id="viewDiv">
  </div>
<script>
require(['esri/config', 'esri/Map', 'esri/views/MapView', 'esri/layers/VectorTileLayer'], function (esriConfig, Map, MapView, VectorTileLayer) {
  const headers = { 'X-Requested-With': 'XMLHttpRequest' };
  const jwt = localStorage.getItem('Bearer:/gishub/api');
  if (!!jwt) {
    headers['Authorization'] = `Bearer ${jwt}`;
  }
  esriConfig.request.interceptors.push({
    urls: /gishub/,
    headers
  });
  // /gishub/rest/services/tile-maps/1600409603668030071/MapServer glabel
  // /gishub/rest/services/tile-maps/1600409446764030070/MapServer gaofen
  const map = new Map({
    basemap: 'streets'
  });
  const view = new MapView({
    container: 'viewDiv', // Reference to the scene div created in step 5
    map: map, // Reference to the map object created before the scene
    zoom: 7, // Sets zoom level based on level of detail (LOD)
    center: [113, 22] // Sets center point of view using longitude,latitude
  });
  Object.assign(window, { _mapview: view });
  const vector = new VectorTileLayer({
    style: {
      version: 8,
      name: "landuse",
      center: [113.307649675, 23.1200491021],
      zoom: 8,
      sprite: "https://app.gdeei.cn/arcgis-js-api/mapbox/sprites/satellite-streets/sprite",
      glyphs: "https://app.gdeei.cn/arcgis-js-api/mapbox/glyphs/{fontstack}/{range}.pbf",
      sources: {
        esri: {
          type: "vector",
          tiles: ["http://localhost:5000/gishub/rest/services/tile-maps/1606700554727030556/MapServer/tile/{z}/{y}/{x}"]
        }
      },
      "layers": [
        {
            "id": "landuse_gd_2019/林地",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                2
            ],
            "layout": {},
            "paint": {
                "fill-color": "#38A800"
            }
        },
        {
            "id": "landuse_gd_2019/草地",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                3
            ],
            "layout": {},
            "paint": {
                "fill-color": "#39F75C"
            }
        },
        {
            "id": "landuse_gd_2019/水域",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                4
            ],
            "layout": {},
            "paint": {
                "fill-color": "#00C5FF"
            }
        },
        {
            "id": "landuse_gd_2019/建筑用地",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                5
            ],
            "layout": {},
            "paint": {
                "fill-color": "#E60000"
            }
        },
        {
            "id": "landuse_gd_2019/未利用土地",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                6
            ],
            "layout": {},
            "paint": {
                "fill-color": "#B2B2B2"
            }
        },
        {
            "id": "landuse_gd_2019/耕地",
            "type": "fill",
            "source": "esri",
            "source-layer": "landuse_gd_2019",
            "filter": [
                "==",
                "_symbol",
                7
            ],
            "layout": {},
            "paint": {
                "fill-color": "#FFD37F"
            }
        }
      ]
    }
  });
  map.add(vector);
});
</script>
</body>

</html>
