<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapbox Demo</title>
  <style>html,body,#viewDiv { padding: 0; margin: 0; height: 100%; width: 100%; overflow: hidden; }</style>
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.13.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.13.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
  <div id="viewDiv">
  </div>
  <script>
    var map = new mapboxgl.Map({
      container: 'viewDiv',
      style: {
        version: 8,
        name: "landuse",
        center: [113.307649675, 23.1200491021],
        zoom: 8,
        sprite: "https://app.gdeei.cn/arcgis-js-api/mapbox/sprites/satellite-streets/sprite",
        glyphs: "https://app.gdeei.cn/arcgis-js-api/mapbox/glyphs/{fontstack}/{range}.pbf",
        sources: {
          esri: {
            type: "vector",
            tiles: ["http://localhost:5000/gishub/rest/services/tile-maps/1606700554727030556/MapServer/tile/{z}/{y}/{x}"]
          }
        },
        "layers": [
          {
              "id": "landuse_gd_2019/林地",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  2
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#38A800"
              }
          },
          {
              "id": "landuse_gd_2019/草地",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  3
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#39F75C"
              }
          },
          {
              "id": "landuse_gd_2019/水域",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  4
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#00C5FF"
              }
          },
          {
              "id": "landuse_gd_2019/建筑用地",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  5
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#E60000"
              }
          },
          {
              "id": "landuse_gd_2019/未利用土地",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  6
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#B2B2B2"
              }
          },
          {
              "id": "landuse_gd_2019/耕地",
              "type": "fill",
              "source": "esri",
              "source-layer": "landuse_gd_2019",
              "filter": [
                  "==",
                  "_symbol",
                  7
              ],
              "layout": {},
              "paint": {
                  "fill-color": "#FFD37F"
              }
          }
        ]
      },
      transformRequest: (url, resourceType) => {
        if (resourceType === 'Tile' && url.startsWith('http://localhost:5000/gishub/rest')) {
          var headers = { 'X-Requested-With': 'XMLHttpRequest' };
          jwt = localStorage.getItem('Bearer:/gishub/api');
          if (!!jwt) {
            headers['Authorization'] = `Bearer ${jwt}`;
          }
          return { url, headers };
        }
      }
    });
  </script>
</body>
</html>
